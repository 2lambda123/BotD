<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FingerprintJS Bot Detect</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" type="image/ico" href="./favicon.ico">
</head>
<body>
<div class="content">
    <img id="logo" src="logo.svg" alt="FingerprintJS">
    <h1>Bot Detect Playground</h1>

    <form class="url_form">
        <label>
            <input id="url" type="text" placeholder="URL of bot detection server">
        </label>
        <button id="button" type="button">Start detect</button>
    </form>

    <div class="output_holder">
        <section class="output">
            <h5>Time to get result:</h5>
            <pre class="output_div" id="time"></pre>
            <h5>Collected data:</h5>
            <pre class="output_div" id="sources"></pre>
            <h5>Detector result:</h5>
            <pre class="output_div" id="result"></pre>
        </section>
    </div>

    <div id="error" style="display: none">
        Please specify URL of bot detection server in form, or as url parameter
    </div>

    <script type="module">
      import {BotDetector} from "../dist/index.js";

      document.getElementById("button").addEventListener("click", function() {
        getResults(undefined).then( time => document.getElementById("time").textContent = `${time.toFixed(0)} ms`)
      }, false);

      const urlParametersString = window.location.search;
      const urlParameters = new URLSearchParams(urlParametersString);
      const serverUrl = urlParameters.get('url')

      if(serverUrl != null) {
        getResults(serverUrl).then( time => document.getElementById("time").textContent = `${time.toFixed(0)} ms`)
      }
      else {
        document.getElementsByClassName("output_holder")[0].style.display = "none"
        document.getElementById("error").style.display = "block"
      }

      async function getResults(url=undefined) {
        let t0 = performance.now()
        if(url === undefined) {
          url = document.getElementById("url").value;
          document.getElementsByClassName("output_holder")[0].style.display = "block"
          document.getElementById("error").style.display = "none"
        }

        let botDetector = new BotDetector(url)
        await botDetector.detect()
        document.getElementById("sources").innerHTML = JSON.stringify(botDetector.sources, null, 4)
        document.getElementById("result").innerHTML = JSON.stringify(botDetector.result, null, 4)
        let t1 = performance.now()
        return t1 - t0
      }

    </script>
</div>
</body>
</html>